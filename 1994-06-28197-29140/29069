Path: msuinfo!agate!howland.reston.ans.net!europa.eng.gtefsd.com!sundog.tiac.net!usenet.elf.com!rpi!wrf
From: wrf@speed.ecse.rpi.edu (Wm Randolph Franklin)
Newsgroups: comp.sys.sun.apps,sci.crypt,comp.unix.programmer
Subject: Local mount for cfs fails
Date: 27 Jun 1994 20:54:09 GMT
Organization: Rensselaer Polytechnic Institute, Troy NY, USA
Lines: 105
Message-ID: <2une9h$ln8@usenet.rpi.edu>
Reply-To: wrf@ecse.rpi.edu
NNTP-Posting-Host: speed.ecse.rpi.edu
Xref: msuinfo comp.sys.sun.apps:8686 sci.crypt:29069 comp.unix.programmer:20331

I'm trying to get the local mount for the Cryptographic File
System to work.  It works fine for me on a Sun IPC, but fails on a
Sparc 10/30.  Both are running Sunos 4.1.3.  Here are the relevant
instructions:

   Now create the CFS mount point (mkdir /crypt).  Edit /etc/exports to
   export some valid local file system to localhost, e.g.:

   / localhost

   and make sure mountd is running and sees it (you may have to start up
   mountd by hand or do a "/etc/exportfs -a").  Now you should be able to
   mount CFS just as you would a remote NFS server:

   /etc/mount -o port=3049,intr localhost:/ /crypt

On the 10/30, the last step gives:

   /etc/mount -o port=3049,intr -t nfs / /crypt
   mount: nfs file system; use host:path
   mount: giving up on:
      /crypt

Maybe / isn't exported?  No, it's ok:

   # exportfs
   / -access=localhost

Maybe localhost is bad?  No, it seems ok:

   # ping -s localhost
   PING localhost: 56 data bytes
   64 bytes from localhost.rpi.edu (127.0.0.1): icmp_seq=0. time=1. ms
   64 bytes from localhost.rpi.edu (127.0.0.1): icmp_seq=1. time=0. ms

The above commands give the same answers on the IPC, on which the
export does work.  

I simplified the export command.  The following works:

   # /etc/mount -o port=3049,intr -t lo / /crypt

but the following fails:

   #/etc/mount -o port=3049,intr -t nfs localhost:/ /crypt
   mount: access denied for localhost:/
   mount: giving up on:
      /crypt

and this:

   # /etc/mount -o port=3049,intr -t nfs foo.bar.edu:/ /crypt
   mount: access denied for foo.bar.edu:/
   mount: giving up on:
      /crypt

However, if I export / to another machine:

   # exportfs
   / -access=localhost:foo.bar.edu:gorp.bar.edu

then, on gorp, I can say ls /n/gorp, and mount foo fine.
My next thought was that the cfsd server isn't listening properly
on port 3049, so I tried:

   # mount -o port=1234,intr localhost:/ /crypt
   mount: access denied for localhost:/
   mount: giving up on:
      /crypt

It appears that this doesn't get far enough to try the nonexistent
server here; the authentication failure is happening in mount.

NFS is working on foo.  As shown above, it can export to other
systems.  It can also import other systems' NFS disks:

   # df
   Filesystem            kbytes    used   avail capacity  Mounted on
   /dev/sd0a              15487   13389     550    96%    /
   gorp.bar.edu:/extern/src
			2097144       0 2097144     0%    /a/speed.ecse.rpi.edu/root/extern/src

LOFS is working as shown above.  Also the kernel appears to have
the relevant options:

   options QUOTA           # disk quotas for local disks
   options UFS             # filesystem code for local disks
   options NFSCLIENT       # NFS client side code
   options NFSSERVER       # NFS server side code
   options LOFS            # loopback filesystem - needed by NSE
   options TFS             # translucent filesystem - needed by NSE
   options TMPFS           # tmp (anonymous memory) file system
   options HSFS            # High Sierra (ISO 9660) with Rock Ridge extensions CD-ROM file system
   options PCFS            # Unix access to MS-DOS file system
    etc

What's happening here?  It's possible that in configuring the
system I turned on some security feature that's stopping this.
Ideas?  Thanks.

------------------------
 Wm. Randolph Franklin,  wrf@ecse.rpi.edu, (518) 276-6077;  Fax: -6261
 ECSE Dept., 6026 JEC, Rensselaer Polytechnic Inst, Troy NY, 12180 USA
 For more info, including PGP and RIPEM keys, finger -l wrf@ecse.rpi.edu

