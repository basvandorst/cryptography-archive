
optionally realloc buffers smaller when it's worth it.

replace all calls to strtoul with a macro.

