Newsgroups: sci.crypt
Path: msuinfo!agate!howland.reston.ans.net!wupost!udel!news.sprintlink.net!news.dorsai.org!stevalln
From: stevalln@dorsai.org (Steve_Allen)
Subject: My hardware RNG part III
Message-ID: <Cv83D8.KJv@dorsai.org>
Organization: The Dorsai Embassy, New York, NY
X-Newsreader: TIN [version 1.2 PL2]
Date: Sun, 28 Aug 1994 02:10:19 GMT
Lines: 52

   I continue to fiddle with my random number generator. Here's the
latest report:
   The previous version (2 oscillators: 4KHz, really noisy; 180KHz,
relatively stable) suffered from noise spikes getting into the
power supply. I couldn't get the noise out of my noise generator! I
decided that the 74HC00 nand gate, which comprised the high-speed
oscillator and which was the source of the spikes, had to go.
   I had some LT-1054 voltage converters on hand, and was able to
easily implement Mark Johnson's (mjohnson@netcom13.netcom.com)
15-volt zener noise source. (btw, in his diagram those should be
15V/1W zeners, not 15V/1A.) I only need one converter to double my
9V power source to 18.
   I found that my 13.8V junkbox zener puts out about as much noise
as a reverse-biased emitter-base junction (100mV p-p) at optimum
current, which is about 50 uA. Lowering the current from this value
tends to reduce the noise.
   For the amp, I abandoned the 324 op-amp and tried Mark Johnson's
74HC04 hex inverter approach. DigiKey has discontinued the 74HC04;
I obtained some 74AC04s and some 74C04s. (The ACs are faster than
the HCs, the Cs are slower.) This turned out to be serendipity.
   I was unable to bias the 74AC04. Besides, they are *extremely*
fast and if you don't wet-nurse the power supply and layout they
won't work at all. The 74C04, however, biases easily and puts
negligable noise on the power lines. After 3 inverters I have a
good clipped signal.  But there is still a significant analog
component wandering around amid the 1s and 0s.
   So I send this signal to a simple 4700-ohm/.0047uF low-pass
filter, and on to a 393 comparator with 10% hysterisis.  Now at
this point I have a beautiful digital signal with a minimum period
of 1 microsecond and a maximum of about 100 microseconds.
   This signal was fed into a 4520 counter. I like this counter
because I can freeze its Enable input and hold the signal steady
for reading. I was reading one bit every 2mS from the /4 output. No
problem, right?
   Well, even with such elaborate care given to the input signal,
the counter stubbornly insisted on putting out too many 1s. For
every 8000 bits it would average 4050 1s and 3950 0s. This was
regardless of which output (/2, /4, /8, /16) I sampled. I went nuts
for two weeks over this! My best guess was some kind of obscure
internal glitch due to improper signal conditioning (thus the
low-pass filters, etc.)....
   I ended up ditching the counter. In its place I now use a 4013
dual D flip-flop. The first ff is configured as a /2, which
neutralizes any offset in the analog section. The second ff is
controlled by the PIC processor to freeze new data for reading.
   Wow. Now I see NO aberrant noise in any of the analog, and the
output spectrum is wonderfully flat. Current consumption is 8.5 mA
@ 9 volts. I am hopeful that this will turn out to be a pretty robust
design.
   Testing (and fiddling) continues.
-Steve

