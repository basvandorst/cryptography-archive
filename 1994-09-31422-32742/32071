Path: msuinfo!netnews.upenn.edu!news.amherst.edu!news.mtholyoke.edu!news.byu.edu!gatech!howland.reston.ans.net!pipex!sunic!trane.uninett.no!eunet.no!nuug!EU.net!uunet!svc.portal.com!shell.portal.com!hfinney
From: hfinney@shell.portal.com (Hal)
Newsgroups: sci.crypt
Subject: An RC4 cycle that can't happen
Date: 18 Sep 1994 16:31:58 GMT
Organization: Portal Communications (shell)
Lines: 32
Message-ID: <35hq1u$c72@news1.shell>
References: <3555ls$fsv@news.xs4all.nl>
NNTP-Posting-Host: jobe.shell.portal.com

I thought last night I had found a possible cyclic behavior in the
alleged RC4 algorithm, but it turns out it can't happen.

If we ever entered the top of the loop with y==x+1 and state[y]==1, there
would be a problem.  x would be incremented so state[x]==1.  Then y
gets state[x] added to it so it becomes x+1 again.  Then we swap state[x]
and state[y] so state[y] is 1 again.  This relationship therefore becomes
invariant.

However, for the same reason, it can't happen.  Entering the loop,
state[y] always holds what y was just incremented by in the previous
iteration.  If that is a 1 that means y was incremented by 1 the previous
time, which means it entered the previous loop as y==x+1, and similarly
state[y] would have had to be 1 on that previous iteration.  So unless
the algorithm starts in this state it can't fall into it.  Since the
algorithm starts with y==x and not y==x+1 it can't start in that state.
Hence it never happens.

It is interesting that it is the pre-increment of x in the loop which
makes sure it can't start in this state.  If x were incremented at the
bottom of the loop rather than the top then if state[0] were 1 at
startup this problem would occur.  So this behavior was probably known
to the designers and guarded against.

So, about the only thing this tells you is that when state[x]==1 in the
calculation, y is never x+1.  Maybe this could provide some subtle
information to help a cryptanalyst but it doesn't seem very useful.

I wonder if there are any other particular relations between x, y, and
the state array which might produce unusual patterns of behavior.

Hal Finney
