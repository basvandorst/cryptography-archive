Newsgroups: sci.crypt
Path: msuinfo!netnews.upenn.edu!dsinc!spool.mu.edu!howland.reston.ans.net!math.ohio-state.edu!jussieu.fr!univ-lyon1.fr!swidir.switch.ch!newsfeed.ACO.net!Austria.EU.net!EU.net!uknet!cix.compulink.co.uk!klockstone
From: klockstone@cix.compulink.co.uk ("Keith Lockstone")
Subject: Re: My hardware RNG part III
Message-ID: <CvIMxA.5Jr@cix.compulink.co.uk>
Organization: Compulink Information eXchange
References: <Cv83D8.KJv@dorsai.org> <jathomasCvBtun.CuJ@netcom.com>
Date: Fri, 2 Sep 1994 18:48:46 GMT
Lines: 148


A few notes and flames on hardware RNG's:
 
pgut1@cs.aukuni.ac.nz (Peter Gutmann) quotes:
> ~Newsgroups: sci.crypt
> ~From: pgut1@cs.aukuni.ac.nz (Peter Gutmann)
> ~Subject: Simple hardware RNG
> ~Date: Thu, 22 Oct 1992 07:07:17 GMT
> The following is a simple hardware noise generator which you 
> can throw together using junk box parts in about 10 minutes.  
> It's based on thermal noise in a zener diode, and is powered by 
> its own supply to reduce the chance of noise from the computers 
> supply being coupled in. 
[followed by circuit etc]
 
The gain of the op amp is 820, as set by the feedback resistor.  
If you look at the open loop gain/frequency curve for a 741 then 
you'll see the frequency is about 1 kHz for this gain.  Allowing 
for a 20 dB overhead so that the feedback can actually work, the 
usable passband of the circuit is about 0 to 100 Hz.
 
For wide bandwidth, the choice of a good amplifier is essential 
and something like an ANALOG DEVICES SSM-2017 is a useful IC.  
 
Another point that hasn't featured in the discussions so far is 
Automatic Gain Control.  Analogue circuits aren't designed for 
saturation working.  If a large signal causes the output of an IC 
to saturate, then there will often be a significant recovery time 
involved - thus affecting the amplified noise signal in an 
unexpected fashion.  This means that it is best to avoid 
saturation and AGC is the best option.  Noise levels from zeners 
is very variable - not to mention the effects of temperature and 
ageing.  If you're building production equipment a second best 
choice would be a Set On Test resistor for gain control. 
 
 
mjohnson@netcom.com (Mark Johnson) says:
> Terry Ritter's article shows some fine examples of good 
> engineering practice.  Regrettably it is applied to ill chosen 
> topologies and therefore results in greater complexity than 
> necessary.  Perhaps "ill chosen" is too harsh -- let me just 
> call his "less than optimum". 
[followed by chat and circuit]
 
Digital circuits are _not_ designed for analogue use.  No 
manufacturer will quote and guarantee gain values for the linear 
portion of a digital gate's i/o characteristic.  Even if one did, 
second sources would probably be totally different.  Similarly 
for other parameters such as Power Supply Rejection Ratio, Open 
Loop Gain etc. 
 
Some digital IC families take large amounts of current from the 
power supply when gates are biased into their linear region.  
This can cause local heating on the chip which is detrimental to 
the life and performance of the device.
 
Many people have come to grief using CMOS gates as oscillators - 
it's bad engineering to rely on non-specified parameters, 
particularly for a production run. 
 
The zener current was derived from a ICL 7660 voltage booster.  
The high dynamic impedance at low zener currents - this could 
impose unwanted ripple on the noise signal. 
 
 
stevalln@dorsai.org (Steve_Allen) says:
> I ended up ditching the counter. In its place I now use a 4013 
> dual D flip-flop. The first ff is configured as a /2, which 
> neutralizes any offset in the analog section. The second ff is 
> controlled by the PIC processor to freeze new data for reading. 
 
There's a limit to the usefulness of this idea - look at the 
differential between the delays from the clock input to a) the 
rising edge output and b) the falling edge output.
 
 
Own experience with zeners (1986):
 
  BZY88  series (400 mW)   Manuf: Mullard (now Philips)
  BZX79C series (400 mW)     "       "      "     "
 
NB It is suspected that these figures and the overall zener 
characteristics are a function of the manufacturing process.  
Other series may be _very_ different. 
 
At low currents (10-20uA), zener avalanche effects dominate, 
producing noise with negative going spikes.  (About 10:1 mark to 
space ratio)  At higher currents (about 60uA) the spikes are 
roughly symmetrical and higher still (about 120uA) positive 
spikes are observed.  Also noted was a negative resistance 
section in the zener characteristic that corresponded to the 
symmetric noise (60uA) region. 
 
In terms of amplitude, the output voltages peaked in the central 
range.  At low currents, the zener's capacitance limited its high 
frequency performance.  This had a marked effect: as the current 
increased the exponential rise time of the spikes decreased.  At 
very high currents, the noise output voltage reduced and the 
avalanche effects disappeared, leaving a more 'normal' type of 
thermal noise.
 
None of the devices produced a flat noise spectrum.
 
In line with the manufacturers data, the higher the zener 
voltage, the higher was the noise produced.  Also as the current 
was lowered, the noise increased:
 
           noise at      noise at
   Vz      Iz = 1mA      Iz = 5mA
   3.0       20            11        uV rms (10Hz - 50 kHz)
   5.1       13             8
   6.8       25            15
  10         87            43
  20        210            60
  30        350            73
 
In practical terms, if these devices were to be used, there is 
the need for a 20-30 volt supply rail just for the zener.  
Voltage boosting could be used, but then a voltage regulator must 
be used to remove the ripple from the booster.  The dynamic 
impedance of zeners in this region can be quite high, so the 
ripple could be imposed on the signal. 
 
One good paper on the subject (as of 1986) was:
 
YARZA, A.R and MARTINEZ, P.A.: 'A true random pulse train 
generator', Electronic Engineering, Mid-October, 1978, pp. 21-23.
 
 
Further thoughts:
 
1.  Always look at the noise with a fast 'scope and a good 
    spectrum analyser.
 
2.  Keep the circuit well screened and take all the earthing 
    precautions that are normally associated with RF circuitry. 
 
3.  If the random data is MD5'd is any discernable pattern 
    imposed on the result?
 
4.  Beware of 'junk box' components - it may be 30 years old and 
    the only one for a 1,000 miles.  Use proven technology and 
    multi-sourced components. 
 
Regards,
 
Keith Lockstone.
 
