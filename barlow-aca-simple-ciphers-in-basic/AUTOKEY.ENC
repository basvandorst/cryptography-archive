10 '** AUTOKEY/ENC ** BY MB 1987 ibm vers Feb 89
20 'does all varieties of autokeys
40 GOTO 2010 'initialise and get example
50 '
330 '
  --- SUB: elim blanks in PT$  ---
340 Z=1
350 X=INSTR(PT$," "):IF X>0 THEN Z=X:PT$=LEFT$(PT$,X-1)+RIGHT$(PT$,LEN(PT$)-X):GOTO 350
360 RETURN
840 '
           ---- process the keyword ----
850 PRINT:PRINT
860 KW$="":PRINT"Enter the keyword (UPPER CASE): "
870 IF XKW$>""THEN PRINT"(Press ENTER for "XKW$"): ";
880 Y=CSRLIN:X=POS(0):LINE INPUT KW$
885 LOCATE Y1+4,1:PRINT SPC(79)
890 IF KW$=""AND XKW$>""THEN KW$=XKW$:LOCATE Y,X:PRINT KW$
900 IF KW$=""THEN 2250
910 IF ASC(MID$(KW$,2,1))>96 THEN LOCATE Y+1,1:PRINT"UPPER CASE please!":GOTO 2250
920 KW=LEN(PT$):RK$=KW$:KW$=LEFT$(KW$+PT$,KW)
930 '
       ---- display on screen in KWs horizontally ----
940 ON ERROR GOTO 1030
950 Y=CSRLIN:LOCATE 2,60:PRINT"Key = "RK$;:LOCATE Y+1,1:PRINT"Ciphertext =":
960 KK=1:OP$=""
970 FOR M=1 TO LP
980   X$=MID$(PT$,M,1)
981   ON INSTR("123",TY$)GOSUB 991,993,995:GOTO 1000
991    X=ASC(X$)+ASC(MID$(KW$,M,1))-65:IF X>90 THEN X=X-26
992    RETURN:'Vig
993    X=ASC(MID$(KW$,M,1))-ASC(X$)+65:IF X<65 THEN X=X+26
994    RETURN:'Beau
995    X=ASC(X$)-ASC(MID$(KW$,M,1))+65:IF X<65 THEN X=X+26
996    RETURN:'Var
1000  PRINT CHR$(X);:OP$=OP$+CHR$(X)
1015  KK=KK+1:IF KK=6 THEN KK=1:PRINT" ";:OP$=OP$+" "
1020 NEXT:PRINT:GOTO 1040
1030 RESUME 1040
1040 ON ERROR GOTO 0
1060 GOTO 9260
1080 LOCATE Y1+2,1:FOR Y=Y1+2 TO 23:PRINT SPC(79);:NEXT:GOTO 2250
1090 LOCATE 22,39:PRINT"end":END
1130 '
     ---- display PORTA on screen in KWs horizontally ----
1150 LOCATE 2,45:PRINT"Key = "KW$;:LOCATE 4,1:PRINT CHR$(31)"Plaintext"TAB(1+2*(KW+2)+3)"Ciphertext"
1160 FOR N=0 TO LEN(PT$)/KW:IF N>=13 THEN OS=KW+2-13*64 ELSE OS=0
1170  FOR M=1 TO KW
1180    X$=MID$(PT$,M+N*KW,1)
1190    Y=ASC(MID$(KW$,M,1))-64:IF Y/2<>INT(Y/2)THEN Y=Y+1 'pair        the keys A&B=2;O&P=16;Y&Z=26
1200    Y=Y/2     'use only 1/2 the Vig tableau
1210    H$=MID$(NL$,Y,13)   'get horiz partial albet
1220    X=INSTR(H$,X$)      'find posn of PT in H$
1230    IF X=0 THEN X=INSTR(TL$,X$):TL=1 ELSE TL=0 'if not in H$        must be in TL$
1240    IF TL THEN OP$=MID$(H$,X,1):GOTO 1260
1250    OP$=MID$(TL$,X,1)
1260    LOCATE 61593!,+1:PRINT4,X$;
1270    LOCATE 26099,+1:PRINT+2)+3+M+N*64,OP$;
1280    KK=KK+1:IF KK=LP THEN 1300 'count chars
1290 NEXT:NEXT
1300 GOTO 1050
2000 '
                 ---- initialisation ----
2010 KEY OFF:CLEAR :DEFINT A-Z:GOSUB 10000
2030 DIM F%,L%,I%,C%,P%,N%,S%,D%,X%,A1%,X$,Q$,N1%,M%,J%,C$,KW$,K%,CT$,KW%,T!,PH!,LC%,K$,XK$,SO$,XS$,CC$,SK%,KK%,XC$,LK%,PK$,DT$,C1%,RT$,K1%,XS%,XL%,X%,E%,T%,CT$,M%
2040 AL$="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
2050 LK$="ACEGIKMOQSUWY":RK$="BDFHJLNPRTVXZ":TL$="ABCDEFGHIJKLM":NL$="NOPQRSTUVWXYZNOPQRSTUVWXYZ"
2060 '
2070 CLS:PRINT DATE$ TAB(31)"AUTOKEY ENCIPHERMENT":PRINT TAB(31)STRING$(20,"-")
2080 DIM X(20,26),E(26),M!(30),M(30),FC(16)
2090 PRINT:PRINT TAB(34)"By Mike Barlow ":PRINT
2120 PRINT TAB(20)"Do you want a (1) Vigenere":PRINT TAB(34)"(2) Beaufort"TAB(31)"or (3) Variant Autokey? ";:LINE INPUT TY$
2130 IF INSTR("123",TY$)=0 THEN 2120
2140 ON INSTR("123",TY$)GOSUB 10010,10020,10030 'get example
2150 CLS:PRINT DATE$ TAB(27)TI$+" AUTOKEY ENCIPHERMENT":PRINT TAB(27)STRING$(LEN(TI$)+21,"-")
2160 '
                  ---- keyboard entry ----
2170 LOCATE 5,1:PT$="":PRINT:PRINT"Please enter the plaintext (UPPER CASE, with or without spaces): ";:LINE INPUT PT$
2180 IF PT$=""THEN PT$=XPT$:PRINT PT$;
2190 RP$=PT$:GOSUB 330              'delete blanks in text
2200 LP=LEN(PT$):CP$="("+RIGHT$(STR$(LP),LEN(STR$(LP))-1)+" chars).":PRINT"  "CP$          'add char count
2210 DIM T(LP+1)
2220 PRINT:PRINT"Please enter the source of the text";:IF XSO$>""THEN PRINT" (default = "XSO$"): "ELSE PRINT": ";
2230 Y1=CSRLIN:X=POS(0):LINE INPUT SO$:IF SO$=""THEN SO$=XSO$:LOCATE Y1,X:PRINT SO$
2240 LOCATE 1,60:PRINT"Source = "SO$;
2250 LOCATE Y1,1:GOTO 840
9250 '
9260 LOCATE 23,1:PRINT"Shall we <P*>rint this for the Cm, <T>ry a new key, do <A>nother, or <Q>uit? ";:LINE INPUT Q$
9270 ON INSTR("PpTtAaQq",Q$)GOTO 9280,9280,1080,1080,10,10,9500,9500:GOTO 9260
9280 ON ERROR GOTO 18000
9290 WIDTH "lpt1:",255    'needed by GWBASIC
9300 EM(0)=-12971:EM(1)=23813:EM(2)=-28469
9310 X=VARPTR(EM(0))
9320 CALL X
9340 FOR N=1 TO 20:LPRINT:NEXT   'space to bottom of page
9350 LPRINT TI$ " AUTOKEY encipherment by Mike Barlow   "DATE$:LPRINT
9360 LPRINT OP$
9370 ON ERROR GOTO 0
9380 LPRINT CHR$(12):GOTO 9260
9500 LOCATE 23,1:PRINT SPC(79):LOCATE 23,39:PRINT "end"
9510 LOCATE 23,1:END
10000 '
                    ----  examples ----
10010 TI$="VIGENERE":XPT$="THE AUTOKEY CAN BE USED WITH VIGENERE VARIANT OR BEAUFORT":XSO$="ACA&U P25":XKW$="PRIMER" :RETURN 'vig
10020 XPT$="THE AUTOKEY CAN BE USED WITH VIGENERE VARIANT OR BEAUFORT":XSO$="ACA&U P25":XKW$="RECIPROCAL":TI$="BEAUFORT":RETURN
10030 XPT$="THE AUTOKEY VAN BE USED WITH VIGENERE VARIANT OR BEAUFORT":XSO$="ACA&U P25":XKW$="APPLE":TI$="VARIANT":RETURN
18000 '   --- printer error trap ---
18010 IF ERR=24 OR ERR=25 OR ERR=27 THEN LOCATE 23,1:PRINT SPC(79):LOCATE 23,15: PRINT "Printer not ready; press <ENTER> to proceed: ";:LINE INPUT Q$:LOCATE 23,1:PRINT SPC(79):RESUME
18020 ON ERROR GOTO 0:STOP
65000 SAVE"autokey.enc",A
