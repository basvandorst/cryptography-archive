	.SPACE	$TEXT$
	.SUBSPA	$CODE$,QUAD=0,ALIGN=8,ACCESS=44,CODE_ONLY
	.SPACE	$TEXT$
	.SUBSPA	$CODE$

	.align	4
	.EXPORT	count_leading_zeros,CODE
	.EXPORT	count_leading_zeros,ENTRY,PRIV_LEV=3,ARGW0=GR,RTNVAL=GR
count_leading_zeros
	.PROC
	.CALLINFO	FRAME=0,NO_CALLS
	.ENTRY

	ldi		0,%r28
	extru,=		%r26,15,16,%r0		; bits xxxx---- zero?
	extru,tr	%r26,15,16,%r26		; no, shift down, skip addi
	addi		16,%r28,%r28
	extru,=		%r26,23,8,%r0		; bits ----xx-- zero?
	extru,tr	%r26,23,8,%r26		; no, shift down, skip addi
	addi		8,%r28,%r28

	addil		l'clz_tab,%r26
	ldb		r'clz_tab(0,%r1),%r26
	bv		0(2)
	add		%r26,%r28,%r28

	.EXIT
	.PROCEND

clz_tab
;0
        .WORD  0x08070606, 0x05050505, 0x04040404, 0x04040404
;16
        .WORD  0x03030303, 0x03030303, 0x03030303, 0x03030303
;32
        .WORD  0x02020202, 0x02020202, 0x02020202, 0x02020202
        .WORD  0x02020202, 0x02020202, 0x02020202, 0x02020202
;64
        .WORD  0x01010101, 0x01010101, 0x01010101, 0x01010101
        .WORD  0x01010101, 0x01010101, 0x01010101, 0x01010101
        .WORD  0x01010101, 0x01010101, 0x01010101, 0x01010101
        .WORD  0x01010101, 0x01010101, 0x01010101, 0x01010101
;128
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
        .WORD  0x00000000, 0x00000000, 0x00000000, 0x00000000
