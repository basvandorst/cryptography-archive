Newsgroups: sci.crypt,alt.security.pgp
Path: msuinfo!uwm.edu!zaphod.mps.ohio-state.edu!howland.reston.ans.net!gatech!emory!sol.ctr.columbia.edu!ira.uka.de!news.dfn.de!rzsun2.informatik.uni-hamburg.de!fbihh!bontchev
From: bontchev@fbihh.informatik.uni-hamburg.de (Vesselin Bontchev)
Subject: Re: disk safety measure?
Message-ID: <bontchev.734171809@fbihh>
Sender: news@informatik.uni-hamburg.de (Mr. News)
Reply-To: bontchev@fbihh.informatik.uni-hamburg.de
Organization: Virus Test Center, University of Hamburg
References: <1993Apr5.084703.23757@ucsu.Colorado.EDU> <gradyC50MF5.6tv@netcom.com> <1pq0re$gc2@network.ucsd.edu> <1993Apr6.235830.28079@fsl.noaa.gov>
Date: Wed, 7 Apr 1993 08:36:49 GMT
Lines: 44
Xref: msuinfo sci.crypt:14878 alt.security.pgp:2413

bear@kestrel.fsl.noaa.gov (Bear Giles) writes:

> I am 99% certain DOS doesn't clear the bytes at the end of a program
> file when you load it, either.  (I believe the Amiga OS does, in contrast).

It depends on what do you mean by "load". When you tell DOS to execute
a program, it reads the file sector by sector in its buffers and
copies it to the memory chunk allocated for that program. Since the
buffers can read/write only entire sectors, obviously at least the
junk after the end of the file up to the end of the sector will be
loaded in the buffer. However, only the file itself will be transfered
to the memory chunk where the program is to be executed.

> Now, the big question: is DOS, or any other OS, dumb enough to simply follow
> the file pointer chain and not check the nominal size of a file at all?

No.

> That is, if I have a program which fits into a single block (with the 
> correct size) but the FAT table says it that a second block follows it,
> does DOS load that block as well?

No, it loads only the first block and says "Error in EXE file" (even
if it were a COM file). However, since the first block -is- loaded and
executed, this is still a security hole. And indeed, there is at least
one virus that uses this.

The virus is the Necropolis virus (1963). It overwrites the beginning
of the infected files, moves the overwritten part after the end of the
file (allocating FAT clusters as it does so), and does not modify the
file size in the directory entry. When you try to run such a file on a
clean system, you get "Error in EXE file", but the virus (at the
beginning of the file) gets loaded in memory. Since it is also a
stealth virus, the -second- time you try to execute the file, it will
be loaded correctly and executed without problems (because the virus
is already active in memory and the file looks "normal").

Regards,
Vesselin
-- 
Vesselin Vladimirov Bontchev          Virus Test Center, University of Hamburg
Tel.:+49-40-54715-224, Fax: +49-40-54715-226      Fachbereich Informatik - AGN
< PGP 2.2 public key available on request. > Vogt-Koelln-Strasse 30, rm. 107 C
e-mail: bontchev@fbihh.informatik.uni-hamburg.de    D-2000 Hamburg 54, Germany
